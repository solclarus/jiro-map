# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is "Jiro Map" (二郎ラーメンマップアプリ) - a Next.js 15 application for mapping Jiro ramen shops. The project uses React 19, TypeScript, and is configured with Biome for linting/formatting instead of ESLint/Prettier.

## Development Commands

- `npm run dev` or `pnpm dev` - Start the development server
- `npm run build` - Build the application for production
- `npm start` - Start the production server
- `npm run lint` or `pnpm lint` - Run Biome linting (`biome check`)
- `npm run format` or `pnpm format` - Format code with Biome (`biome format --write`)

## Database Commands

This project uses Drizzle ORM with PostgreSQL via Supabase:

- `pnpm drizzle:generate` - Generate new database migrations
- `pnpm drizzle:migrate` - Apply migrations to the database
- `pnpm drizzle:gm` - Generate and apply migrations in one command

## Authentication Commands

The project uses Better Auth for authentication:

- `pnpx better-auth generate --output ./src/db/schemas/auth.ts` - Generate auth schema

## Architecture

### Authentication Stack
- **Better Auth**: Primary authentication library with Drizzle adapter
- **Supabase**: Backend database provider (PostgreSQL)
- **Database**: Drizzle ORM with schema defined in `src/db/schemas/auth.ts`
- **Sessions**: Custom nanoid-based ID generation (10 characters)

### Database Architecture
- **Schemas**: Authentication tables (users, sessions, accounts, verifications) in `src/db/schemas/auth.ts`
- **Migrations**: Located in `supabase/migrations/`
- **Database clients**: Separate browser and server Supabase clients

### Frontend Architecture
- **Next.js App Router**: Using the new app directory structure
- **Styling**: Tailwind CSS with TailwindCSS v4
- **UI Components**: Radix UI with shadcn/ui patterns
- **Theming**: next-themes with dark mode support
- **State**: Better Auth React client for authentication state

### Key Architectural Patterns
- **Dual Supabase clients**: Browser client (`supabase/browser-client.ts`) and server client (`supabase/server-client.ts`)
- **Environment-aware base URLs**: Dynamic URL resolution for Vercel deployments via `src/lib/get-base-url.ts`
- **Schema-driven auth**: Drizzle schema auto-generated by Better Auth

## Configuration Files

- **Biome**: `biome.json` - Linting, formatting, and code organization (replaces ESLint/Prettier)
- **TypeScript**: `tsconfig.json` - Uses path mapping (`@/*` → `./src/*`)
- **Drizzle**: `drizzle.config.ts` - Database configuration pointing to auth schema
- **Tailwind**: `postcss.config.mjs` - PostCSS configuration

## Environment Variables Required

Based on the codebase analysis:
- `DATABASE_URL` - PostgreSQL connection string
- `NEXT_PUBLIC_SUPABASE_URL` - Supabase project URL
- `NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY` - Supabase anon key
- `SUPABASE_SECRET_KEY` - Supabase service role key (note: typo in server-client.ts)

## Deployment

- **GitHub Actions**: Automatic database migrations on main branch push (`migrate.yml`)
- **Vercel**: Designed for Vercel deployment with environment detection
- **Database**: Migrations are automatically applied via GitHub Actions

## Code Style

- **Formatter**: Biome with 2-space indentation
- **Import organization**: Automatic import sorting enabled
- **Next.js**: App Router patterns with TypeScript
- **File naming**: kebab-case for most files, PascalCase for React components

## Commit Message Guidelines

Follow these rules when creating commit messages:

- **Format**: Use gitmoji + Conventional Commits format in Japanese
- **Structure**: `<gitmoji> <type>: <description>`
- **Keep it concise**: Use brief, clear descriptions
- **No AI disclaimers**: Do not include AI-generated content disclaimers
- **Examples**:
  - `✨ feat: 認証機能を実装`
  - `🐛 fix: ログイン時のリダイレクト問題を修正`
  - `📱 style: レスポンシブデザインを改善`
  - `♻️ refactor: コンポーネント構造を整理`